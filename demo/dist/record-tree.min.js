var g=`record-tree
{
    display: block;
    --spacing: 7px;
    --indent: 20px;
}

record-tree .collection
{
    border-radius: 3px;
    padding: var(--spacing);
    border: solid 1px transparent;
}
record-tree .collection:hover
{
    border-color: graytext;
}

record-tree .collection > .collection
{
    margin-left: var(--indent);
    margin-block: var(--spacing);
}

record-tree .collection > .property:first-of-type
{
    margin-top: var(--spacing);
}
record-tree .collection > .property
{
    margin-left: var(--indent);
}
record-tree .collection > .property:last-of-type
{
    margin-bottom: var(--spacing);
}

record-tree .removed
{
    scale: .99;
    color: graytext;
}

record-tree summary
{
    user-select: none;
    display: flex;
    gap: var(--spacing);
}
record-tree summary:before
{
    content: '\u25B6';
    transition: transform 100ms ease-out;
    font-size: .78em;
    align-self: center;
    margin-right: var(--spacing);
}
record-tree details[open] > summary:before
{
    transform: rotate(90deg);
}
record-tree summary .name
{
    flex: 1;
}
record-tree :not(.properties) > summary .name
{
    font-weight: bold;
    font-size: .8em;
}

record-tree ul
{
    margin-block: var(--spacing);
    margin-left: var(--indent);
    padding: 0;
}

record-tree .property
{
    user-select: none;
    display: flex;
    align-items: center;
    border-radius: 3px;
    border: solid 1px transparent;
}
record-tree .property:hover
{
    border-color: graytext;
}

record-tree .property .name
{
    font-weight: bold;
    font-size: .8em;    
    text-align: right;

    padding-left: var(--spacing);
    padding-block: var(--spacing);
    width: var(--property-name-width);
}
record-tree .property .value
{
    padding-inline: var(--spacing);
    padding-block: var(--spacing);
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
}

record-tree button
{
    display: inline-flex;
    align-items: center;
    margin-left: auto;
    margin-right: var(--spacing);
}

record-tree button .icon
{
    --size: 14px;
    width: var(--size);
    height: var(--size);
}`;var E=new CSSStyleSheet;E.replaceSync(g);var b="removed",m=`<svg class="icon cancel-cross" viewBox="0 0 22.812714 22.814663" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
    <path style="color:#000000;fill:var(--icon-primary-color,InfoText);stroke:var(--icon-secondary-color,InfoBackground);stroke-linecap:square;stroke-miterlimit:6.3;stroke-dashoffset:29.2913;stroke-opacity:1;-inkscape-stroke:none"
    d="m 1237.4389,207.63366 -1.8991,1.8987 a 0.65841136,0.65841136 90.003442 0 0 0,0.93116 l 0.4831,0.48317 a 14628.329,14628.329 44.999244 0 0 0.9312,0.93118 l 3.7936,3.79311 a 0.65840885,0.65840885 89.998393 0 1 0,0.93116 l -3.7936,3.7936 a 8783.6896,8783.6896 135.00442 0 1 -0.9313,0.93111 l -0.4829,0.48283 a 0.65811,0.65811 89.993977 0 0 10e-5,0.93094 l 1.8987,1.89741 a 0.65867085,0.65867085 179.98891 0 0 0.9314,-1.8e-4 l 0.4826,-0.48267 a 45427.77,45427.77 134.99941 0 1 0.9312,-0.93119 l 3.7931,-3.79308 a 0.65848899,0.65848899 179.99848 0 1 0.9312,-2e-5 l 3.7936,3.79312 a 10110.91,10110.91 44.992994 0 0 0.9313,0.93108 l 0.483,0.48285 a 0.65856615,0.65856615 179.99438 0 0 0.9313,-9e-5 l 1.897,-1.89705 a 0.65833101,0.65833101 89.994378 0 0 -10e-5,-0.93111 l -0.483,-0.48285 a 5293.5057,5293.5057 44.99639 0 1 -0.9313,-0.93113 l -3.793,-3.79354 a 0.65849247,0.65849247 90.001607 0 1 0,-0.93122 l 3.793,-3.79305 a 149190.44,149190.44 134.99995 0 1 0.9312,-0.93119 l 0.4832,-0.48321 a 0.65863247,0.65863247 90.008202 0 0 10e-5,-0.93132 l -1.8972,-1.89834 a 0.65838576,0.65838576 0.01346964 0 0 -0.9312,-2.2e-4 l -0.483,0.48285 a 7148.543,7148.543 135.00546 0 0 -0.9313,0.9311 l -3.7936,3.79359 a 0.65841791,0.65841791 0.00151591 0 1 -0.9312,-3e-5 l -3.7931,-3.79353 a 52707.551,52707.551 45.002134 0 0 -0.9312,-0.93122 l -0.4826,-0.48267 a 0.65849044,0.65849044 0.00323988 0 0 -0.9312,-5e-5 z"
    transform="translate(-1232.6358,-204.72848)" />
</svg>`,f=`<svg class="icon undo-redo" viewBox="0 0 22.812714 22.814663" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
<path
   style="color:#000000;fill:var(--icon-primary-color,InfoText);stroke:var(--icon-secondary-color,CanvasText);fill-opacity:1;stroke-width:0.999999;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"
   d="M 8.7359009 1.1063924 C 8.3768905 1.0950243 8.0017196 1.1736712 7.641394 1.3523722 L 1.6107544 6.1205566 L 1.5916341 6.1386434 L 1.53479 6.1939372 C 1.0620233 6.6537208 0.70744486 7.6004515 1.0769368 8.152474 L 5.3030355 14.40894 C 6.1798306 15.219356 7.5994445 15.083541 8.4749349 14.106116 C 9.2135837 13.277519 9.3398045 12.086041 8.7787923 11.23549 L 11.334192 11.410673 C 14.129266 11.815808 17.330477 13.067707 18.931144 18.826241 C 19.313756 19.953163 19.735424 21.309718 20.245793 22.173324 C 20.976132 22.497497 21.420713 20.679238 21.478792 18.791101 C 21.506716 14.251463 18.262689 8.6142076 13.845667 6.7716797 C 13.291103 6.5403477 11.805521 5.8978235 10.30118 5.3355916 L 9.7994019 5.1107992 C 10.609379 4.4184442 10.916638 3.2966427 10.55026 2.3703979 C 10.238366 1.5905459 9.5257236 1.1314023 8.7359009 1.1063924 z " />
</svg>`,y="record-tree",h=class extends HTMLElement{static observedAttributes=[];#t;path=[];#r=new Set;#n=new Array;#a=new Array;#e=new Array;#i=new Array;#o=new Array;#s=0;constructor(){super(),this.getRootNode().adoptedStyleSheets.push(E),this.addEventListener("click",this.#l.bind(this))}#l(r){let e=r.target.closest("svg")!=null?r.target.closest("button"):r.target;if(e==null||!e.classList.contains("remove"))return;let i=e.parentElement?.classList.contains("property")?e.parentElement:e.parentElement?.parentElement?.classList.contains("collection")?e.parentElement.parentElement:null;if(i==null){console.error("Unknown button clicked");return}if(r.stopPropagation(),r.preventDefault(),this.hasAttribute("removed-class")){let n=this.getAttribute("removed-class");(n==null||n=="")&&(n=b),i.classList.contains(n)?(i.classList.remove(n),i.part.remove(n),i.dataset.path!=".properties"&&this.#r.delete(i.dataset.path),e.innerHTML=m,e.title="Remove",this.dispatchEvent(new CustomEvent("restore",{detail:{path:i.dataset.path}}))):(i.classList.add(n),i.part.add(n),i.dataset.path!=".properties"&&this.#r.add(i.dataset.path),e.innerHTML=f,e.title="Undo",e.classList.add("undo"),e.part.add("undo"),this.dispatchEvent(new CustomEvent("remove",{detail:{path:i.dataset.path}})))}else i.remove(),this.#r.add(i.dataset.path),this.dispatchEvent(new CustomEvent("remove",{detail:{path:i.dataset.path}}))}getPathArray(){return this.path}getCurrentPathString(){return this.path.join(".")}getInitialData(){return this.#t}setData(r){this.#t=r,this.renderRecordData(this.#t)}async renderRecordData(r){this.innerHTML="",this.path=[],await this.renderData(r,this),this.path=[],this.style.setProperty("--property-name-width",`${this.#s}px`)}async renderData(r,e,i=!0){let n=this.path[this.path.length-1]??this.getAttribute("parent-name")??"Data";if(Array.isArray(r)){let a=this.renderArrayAsCollection;for(let t=0;t<this.#n.length;t++)if(this.#n[t].condition(n,r,e)==!0){a=this.#n[t].renderer;break}await a.call(this,n,r,e)}else if(Object.prototype.toString.call(r)==="[object Object]"){r=this.draftObject(r);let a=this.renderObjectAsCollection;for(let t=0;t<this.#a.length;t++)if(this.#a[t].condition(n,r,e)==!0){a=this.#a[t].renderer;break}await a.call(this,n,r,e)}else if(i==!0){let a=this.path.filter((l,p)=>p<this.path.length-1),t=this.querySelector(`details[data-path="${a.join(".")}.properties"]`),o=t==null?null:t.querySelector("ul");t==null&&(t=this.createCollectionDetailsElement("Properties",`${a.join(".")}.properties`,["collection","properties"],!1),t.toggleAttribute("open",!0),o=document.createElement("ul"),t.append(o),e.append(t)),o.children.length>10&&t.toggleAttribute("open",!1);let s=this.renderObjectProperty;for(let l=0;l<this.#e.length;l++)if(this.#e[l].condition(n,r,o)==!0){s=this.#e[l].renderer;break}await s.call(this,n,r,o)}else{let a=this.renderObjectProperty;for(let t=0;t<this.#e.length;t++)if(this.#e[t].condition(n,r,e)==!0){a=this.#e[t].renderer;break}await a.call(this,n,r,e)}}addCustomCollectionRenderer(r,e){this.#n.push({condition:r,renderer:e})}addCustomObjectRenderer(r,e){this.#a.push({condition:r,renderer:e})}addCustomPropertyRenderer(r,e){this.#e.push({condition:r,renderer:e})}addCustomPropertyNameGenerator(r,e){this.#i.push({condition:r,generator:e})}addCustomPropertyValueGenerator(r,e){this.#o.push({condition:r,generator:e})}clear(){this.innerHTML=""}refresh(){this.setData(this.#t)}getUpdatedData(){let r=structuredClone(this.#t);for(let[e]of this.#r.entries()){let i=e.split("."),n=r,a=r[i[0]],t=i[0];for(let o=1;o<i.length;o++)t=i[o],n=a,a=n[t];n!=null&&a!=null&&delete n[t]}return r}createCollectionDetailsElement(r,e,i,n){let a=document.createElement("details");i!=null&&(a.classList.add(...i),a.part.add(...i)),a.setAttribute("data-path",e);let t=document.createElement("summary"),o=document.createElement("span");if(o.textContent=r,o.classList.add("name"),o.part.add("name"),t.append(o),n!=!1){let s=document.createElement("button");s.innerHTML=m,s.title="Remove",s.classList.add("remove"),s.part.add("remove"),t.append(s)}return a.append(t),a}async renderArrayAsCollection(r,e,i){let n=isNaN(parseInt(r))?r:`[${r}]`,a=this.createCollectionDetailsElement(n,this.path.join("."),["collection"]);this.path.length==0&&a.setAttribute("open",""),i.append(a);for(let t=0;t<e.length;t++)this.path.push(t.toString()),await this.renderData(e[t],a,!1),this.path.pop()}async renderObjectAsCollection(r,e,i){let n=isNaN(parseInt(r))?r:e.name!=null&&e.name.trim()!=""?e.name:e.description!=null&&e.description.trim()!=""?e.description:e.key!=null&&e.key.trim()!=""?e.key:e.id!=null&&e.id.toString().trim()!=""?e.id:`[${r}]`,a=this.createCollectionDetailsElement(n,this.path.join("."),["collection"]);this.path.length==0&&a.setAttribute("open",""),i.append(a);for(let[t,o]of Object.entries(e))this.path.push(t),await this.renderData(e[t],a),this.path.pop()}async renderObjectProperty(r,e,i){let n=i instanceof HTMLUListElement?"li":"div",a=document.createElement(n);a.classList.add("property"),a.part.add("property"),a.dataset.path=this.path.join(".");let t=this.createPropertyName;for(let d=0;d<this.#i.length;d++)if(this.#i[d].condition(r,e,i)==!0){t=this.#i[d].generator;break}let o=await t(r,e,i),s=document.createElement("span");s.classList.add("delimiter"),s.part.add("delimiter"),s.textContent=":";let l=this.createPropertyValue.bind(this);for(let d=0;d<this.#o.length;d++)if(this.#o[d].condition(r,e,i)==!0){l=this.#o[d].generator;break}let p=await l(r,e,i),c=document.createElement("button");c.innerHTML=m,c.title="Remove",c.classList.add("remove"),c.part.add("remove"),a.append(o,s,p,c),a.title=`${o.getAttribute("title")}: ${p.getAttribute("title")}`,i.append(a);let u=Math.ceil(o.getBoundingClientRect().width);this.#s<u&&(this.#s=u)}createPropertyName(r,e,i){let n=document.createElement("span");return n.classList.add("name"),n.part.add("name"),n.textContent=r,n.title=r,n}createPropertyValue(r,e,i){let n=document.createElement("span");return n.classList.add("value"),n.part.add("value"),e===void 0?e=this.getAttribute("undefined-value")??"[ undefined ]":e===null?e=this.getAttribute("null-value")??"[ null ]":e=e.toString(),e.trim()==""&&(e=this.getAttribute("blank-value")??"[ blank text ]"),n.textContent=e.length>1024?e.substring(0,1024):e,n.title=e.startsWith("data:")?"[ Binary Data ]":e,n}async renderCollectionAsKeyValuePairs(r,e,i){let n=this.createCollectionDetailsElement(r,this.path.join("."),["collection","key-value-pairs"]),a=document.createElement("ul");n.append(a);for(let t=0;t<e.length;t++)this.path.push(e[t].key),await this.renderObjectProperty(e[t].key,e[t].value,a),this.path.pop();i.append(n)}async renderCollectionAsValues(r,e,i){let n=this.createCollectionDetailsElement(r,this.path.join("."),["collection","values"]),a=document.createElement("ul");n.append(a);for(let t=0;t<e.length;t++)this.path.push(e[t]),await this.renderObjectAsValue(e[t],e[t],a),this.path.pop();i.append(n)}async renderObjectAsValue(r,e,i){let n=document.createElement("li");n.classList.add("property"),n.part.add("property"),n.dataset.path=this.path.join(".");let a=document.createElement("span");a.classList.add("value"),a.part.add("value"),a.textContent=e.toString(),a.title="[ Object ]";let t=document.createElement("button");t.innerHTML=m,t.title="Remove",t.classList.add("remove"),t.part.add("remove"),n.append(a,t),i.append(n)}renderDataObject(r,e){if(Array.isArray(r))for(let i=0;i<r.length;i++){let n=r[i],a=document.createElement("details"),t=document.createElement("summary"),o=n.name??n.description??n.key;(o==null||o.trim()=="")&&(o=i.toString()),t.classList.add("property"),t.part.add("property"),t.textContent=o.substring(0,Math.min(o.length,20)),a.classList.add("subrecord"),a.part.add("subrecord"),e.appendChild(a),a.appendChild(t),this.renderDataObject(n,a)}else{let i=null;for(let[n,a]of Object.entries(r))if(Array.isArray(a)||Object.prototype.toString.call(a)==="[object Object]"){let t=document.createElement("details"),o=document.createElement("summary");o.classList.add("property"),o.part.add("property"),o.textContent=n,t.classList.add("subrecord"),t.part.add("subrecord"),e.appendChild(t),t.appendChild(o),this.renderDataObject(a,t)}else{i==null&&(i=e.querySelector(":scope > ul"),i==null&&(i=document.createElement("ul"),e.appendChild(i)));let t=document.createElement("li");t.classList.add("property"),t.part.add("property");let o=document.createElement("span");o.classList.add("name"),o.part.add("name"),o.textContent=n;let s=document.createElement("span");s.classList.add("value"),s.part.add("value");let l=a.toString();s.textContent=l.substring(0,Math.min(l.length,20)),t.append(o,s),i.append(t)}}}draftObject(r){return Object.assign({},r,this.extractProperties(r))}extractProperties(r){let e=this.getPropertyNames(r),i={};for(let n=0;n<e.length;n++)i[e[n]]=r[e[n]];return i}getPropertyNames(r){let e=Reflect.getPrototypeOf(r),i=Object.getOwnPropertyDescriptors(e);return Object.entries(i).filter(n=>typeof n[1].get=="function"&&n[0]!=="__proto__").map(n=>n[0])}};customElements.get(y)==null&&customElements.define(y,h);export{h as RecordTreeElement};
