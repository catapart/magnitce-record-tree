var g=`record-tree
{
    display: block;
    --spacing: 7px;
    --indent: 20px;
}

record-tree .collection
{
    border-radius: 3px;
    padding: var(--spacing);
    border: solid 1px transparent;
}
record-tree .collection:hover
{
    border-color: graytext;
}

record-tree .collection > .collection
{
    margin-left: var(--indent);
    margin-block: var(--spacing);
}

record-tree .collection > .property:first-of-type
{
    margin-top: var(--spacing);
}
record-tree .collection > .property
{
    margin-left: var(--indent);
}
record-tree .collection > .property:last-of-type
{
    margin-bottom: var(--spacing);
}

record-tree .removed
{
    scale: .99;
    color: graytext;
}

record-tree summary
{
    user-select: none;
    display: flex;
    gap: var(--spacing);
}
record-tree summary:before
{
    content: '\u25B6';
    transition: transform 100ms ease-out;
    font-size: .78em;
    align-self: center;
    margin-right: var(--spacing);
}
record-tree details[open] > summary:before
{
    transform: rotate(90deg);
}
record-tree summary .name
{
    flex: 1;
}
record-tree :not(.properties) > summary .name
{
    font-weight: bold;
    font-size: .8em;
}

record-tree ul
{
    margin-block: var(--spacing);
    margin-left: var(--indent);
    padding: 0;
}

record-tree .property
{
    user-select: none;
    display: flex;
    align-items: center;
    border-radius: 3px;
    border: solid 1px transparent;
}
record-tree .property:hover
{
    border-color: graytext;
}

record-tree .property .name
{
    font-weight: bold;
    font-size: .8em;    
    text-align: right;

    padding-left: var(--spacing);
    padding-block: var(--spacing);
    width: var(--property-name-width);
}
record-tree .property .value
{
    padding-inline: var(--spacing);
    padding-block: var(--spacing);
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
}

record-tree button
{
    display: inline-flex;
    align-items: center;
    margin-left: auto;
    margin-right: var(--spacing);
}

record-tree button .icon
{
    --size: 14px;
    width: var(--size);
    height: var(--size);
}`;var E=new CSSStyleSheet;E.replaceSync(g);var f="removed",m=`<svg class="icon cancel-cross" viewBox="0 0 22.812714 22.814663" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
    <path style="color:#000000;fill:var(--icon-primary-color,InfoText);stroke:var(--icon-secondary-color,InfoBackground);stroke-linecap:square;stroke-miterlimit:6.3;stroke-dashoffset:29.2913;stroke-opacity:1;-inkscape-stroke:none"
    d="m 1237.4389,207.63366 -1.8991,1.8987 a 0.65841136,0.65841136 90.003442 0 0 0,0.93116 l 0.4831,0.48317 a 14628.329,14628.329 44.999244 0 0 0.9312,0.93118 l 3.7936,3.79311 a 0.65840885,0.65840885 89.998393 0 1 0,0.93116 l -3.7936,3.7936 a 8783.6896,8783.6896 135.00442 0 1 -0.9313,0.93111 l -0.4829,0.48283 a 0.65811,0.65811 89.993977 0 0 10e-5,0.93094 l 1.8987,1.89741 a 0.65867085,0.65867085 179.98891 0 0 0.9314,-1.8e-4 l 0.4826,-0.48267 a 45427.77,45427.77 134.99941 0 1 0.9312,-0.93119 l 3.7931,-3.79308 a 0.65848899,0.65848899 179.99848 0 1 0.9312,-2e-5 l 3.7936,3.79312 a 10110.91,10110.91 44.992994 0 0 0.9313,0.93108 l 0.483,0.48285 a 0.65856615,0.65856615 179.99438 0 0 0.9313,-9e-5 l 1.897,-1.89705 a 0.65833101,0.65833101 89.994378 0 0 -10e-5,-0.93111 l -0.483,-0.48285 a 5293.5057,5293.5057 44.99639 0 1 -0.9313,-0.93113 l -3.793,-3.79354 a 0.65849247,0.65849247 90.001607 0 1 0,-0.93122 l 3.793,-3.79305 a 149190.44,149190.44 134.99995 0 1 0.9312,-0.93119 l 0.4832,-0.48321 a 0.65863247,0.65863247 90.008202 0 0 10e-5,-0.93132 l -1.8972,-1.89834 a 0.65838576,0.65838576 0.01346964 0 0 -0.9312,-2.2e-4 l -0.483,0.48285 a 7148.543,7148.543 135.00546 0 0 -0.9313,0.9311 l -3.7936,3.79359 a 0.65841791,0.65841791 0.00151591 0 1 -0.9312,-3e-5 l -3.7931,-3.79353 a 52707.551,52707.551 45.002134 0 0 -0.9312,-0.93122 l -0.4826,-0.48267 a 0.65849044,0.65849044 0.00323988 0 0 -0.9312,-5e-5 z"
    transform="translate(-1232.6358,-204.72848)" />
</svg>`,b=`<svg class="icon undo-redo" viewBox="0 0 22.812714 22.814663" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
<path
   style="color:#000000;fill:var(--icon-primary-color,InfoText);stroke:var(--icon-secondary-color,CanvasText);fill-opacity:1;stroke-width:0.999999;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"
   d="M 8.7359009 1.1063924 C 8.3768905 1.0950243 8.0017196 1.1736712 7.641394 1.3523722 L 1.6107544 6.1205566 L 1.5916341 6.1386434 L 1.53479 6.1939372 C 1.0620233 6.6537208 0.70744486 7.6004515 1.0769368 8.152474 L 5.3030355 14.40894 C 6.1798306 15.219356 7.5994445 15.083541 8.4749349 14.106116 C 9.2135837 13.277519 9.3398045 12.086041 8.7787923 11.23549 L 11.334192 11.410673 C 14.129266 11.815808 17.330477 13.067707 18.931144 18.826241 C 19.313756 19.953163 19.735424 21.309718 20.245793 22.173324 C 20.976132 22.497497 21.420713 20.679238 21.478792 18.791101 C 21.506716 14.251463 18.262689 8.6142076 13.845667 6.7716797 C 13.291103 6.5403477 11.805521 5.8978235 10.30118 5.3355916 L 9.7994019 5.1107992 C 10.609379 4.4184442 10.916638 3.2966427 10.55026 2.3703979 C 10.238366 1.5905459 9.5257236 1.1314023 8.7359009 1.1063924 z " />
</svg>`,y="record-tree",h=class extends HTMLElement{static observedAttributes=[];#t;path=[];#n=new Set;#r=new Array;#a=new Array;#e=new Array;#i=new Array;#s=new Array;#o=0;constructor(){super(),this.getRootNode().adoptedStyleSheets.push(E),this.addEventListener("click",this.#l.bind(this))}#l(t){let e=t.target.closest("svg")!=null?t.target.closest("button"):t.target;if(e==null||!e.classList.contains("remove"))return;let a=e.parentElement?.classList.contains("property")?e.parentElement:e.parentElement?.parentElement?.classList.contains("collection")?e.parentElement.parentElement:null;if(a==null){console.error("Unknown button clicked");return}if(t.stopPropagation(),t.preventDefault(),this.hasAttribute("removed-class")){let r=this.getAttribute("removed-class");(r==null||r=="")&&(r=f),a.classList.contains(r)?(a.classList.remove(r),a.dataset.path!=".properties"&&this.#n.delete(a.dataset.path),e.innerHTML=m,e.title="Remove",this.dispatchEvent(new CustomEvent("restore",{detail:{path:a.dataset.path}}))):(a.classList.add(r),a.dataset.path!=".properties"&&this.#n.add(a.dataset.path),e.innerHTML=b,e.title="Undo",e.classList.add("undo"),this.dispatchEvent(new CustomEvent("remove",{detail:{path:a.dataset.path}})))}else a.remove(),this.#n.add(a.dataset.path),this.dispatchEvent(new CustomEvent("remove",{detail:{path:a.dataset.path}}))}getPathArray(){return this.path}getCurrentPathString(){return this.path.join(".")}getInitialData(){return this.#t}setData(t){this.#t=t,this.renderRecordData(this.#t)}async renderRecordData(t){this.innerHTML="",this.path=[],await this.renderData(t,this),this.path=[],this.style.setProperty("--property-name-width",`${this.#o}px`)}async renderData(t,e,a=!0){let r=this.path[this.path.length-1]??this.getAttribute("parent-name")??"Data";if(Array.isArray(t)){let i=this.renderArrayAsCollection;for(let n=0;n<this.#r.length;n++)if(this.#r[n].condition(r,t,e)==!0){i=this.#r[n].renderer;break}await i.call(this,r,t,e)}else if(Object.prototype.toString.call(t)==="[object Object]"){t=this.draftObject(t);let i=this.renderObjectAsCollection;for(let n=0;n<this.#a.length;n++)if(this.#a[n].condition(r,t,e)==!0){i=this.#a[n].renderer;break}await i.call(this,r,t,e)}else if(a==!0){let i=this.path.filter((l,d)=>d<this.path.length-1),n=this.querySelector(`details[data-path="${i.join(".")}.properties"]`),s=n==null?null:n.querySelector("ul");n==null&&(n=this.createCollectionDetailsElement("Properties",`${i.join(".")}.properties`,["collection","properties"],!1),n.toggleAttribute("open",!0),s=document.createElement("ul"),n.append(s),e.append(n)),s.children.length>10&&n.toggleAttribute("open",!1);let o=this.renderObjectProperty;for(let l=0;l<this.#e.length;l++)if(this.#e[l].condition(r,t,s)==!0){o=this.#e[l].renderer;break}await o.call(this,r,t,s)}else{let i=this.renderObjectProperty;for(let n=0;n<this.#e.length;n++)if(this.#e[n].condition(r,t,e)==!0){i=this.#e[n].renderer;break}await i.call(this,r,t,e)}}addCustomCollectionRenderer(t,e){this.#r.push({condition:t,renderer:e})}addCustomObjectRenderer(t,e){this.#a.push({condition:t,renderer:e})}addCustomPropertyRenderer(t,e){this.#e.push({condition:t,renderer:e})}addCustomPropertyNameGenerator(t,e){this.#i.push({condition:t,generator:e})}addCustomPropertyValueGenerator(t,e){this.#s.push({condition:t,generator:e})}clear(){this.innerHTML=""}refresh(){this.setData(this.#t)}getUpdatedData(){let t=structuredClone(this.#t);for(let[e]of this.#n.entries()){let a=e.split("."),r=t,i=t[a[0]],n=a[0];for(let s=1;s<a.length;s++)n=a[s],r=i,i=r[n];r!=null&&i!=null&&delete r[n]}return t}createCollectionDetailsElement(t,e,a,r){let i=document.createElement("details");a!=null&&i.classList.add(...a),i.setAttribute("data-path",e);let n=document.createElement("summary"),s=document.createElement("span");if(s.textContent=t,s.classList.add("name"),n.append(s),r!=!1){let o=document.createElement("button");o.innerHTML=m,o.title="Remove",o.classList.add("remove"),n.append(o)}return i.append(n),i}async renderArrayAsCollection(t,e,a){let r=isNaN(parseInt(t))?t:`[${t}]`,i=this.createCollectionDetailsElement(r,this.path.join("."),["collection"]);this.path.length==0&&i.setAttribute("open",""),a.append(i);for(let n=0;n<e.length;n++)this.path.push(n.toString()),await this.renderData(e[n],i,!1),this.path.pop()}async renderObjectAsCollection(t,e,a){let r=isNaN(parseInt(t))?t:e.name!=null&&e.name.trim()!=""?e.name:e.description!=null&&e.description.trim()!=""?e.description:e.key!=null&&e.key.trim()!=""?e.key:e.id!=null&&e.id.toString().trim()!=""?e.id:`[${t}]`,i=this.createCollectionDetailsElement(r,this.path.join("."),["collection"]);this.path.length==0&&i.setAttribute("open",""),a.append(i);for(let[n,s]of Object.entries(e))this.path.push(n),await this.renderData(e[n],i),this.path.pop()}async renderObjectProperty(t,e,a){let r=a instanceof HTMLUListElement?"li":"div",i=document.createElement(r);i.classList.add("property"),i.dataset.path=this.path.join(".");let n=this.createPropertyName;for(let c=0;c<this.#i.length;c++)if(this.#i[c].condition(t,e,a)==!0){n=this.#i[c].generator;break}let s=await n(t,e,a),o=document.createElement("span");o.classList.add("delimiter"),o.textContent=":";let l=this.createPropertyValue.bind(this);for(let c=0;c<this.#s.length;c++)if(this.#s[c].condition(t,e,a)==!0){l=this.#s[c].generator;break}let d=await l(t,e,a),p=document.createElement("button");p.innerHTML=m,p.title="Remove",p.classList.add("remove"),i.append(s,o,d,p),i.title=`${s.getAttribute("title")}: ${d.getAttribute("title")}`,a.append(i);let u=Math.ceil(s.getBoundingClientRect().width);this.#o<u&&(this.#o=u)}createPropertyName(t,e,a){let r=document.createElement("span");return r.classList.add("name"),r.textContent=t,r.title=t,r}createPropertyValue(t,e,a){let r=document.createElement("span");return r.classList.add("value"),e===void 0?e=this.getAttribute("undefined-value")??"[ undefined ]":e===null?e=this.getAttribute("null-value")??"[ null ]":e=e.toString(),e.trim()==""&&(e=this.getAttribute("blank-value")??"[ blank text ]"),r.textContent=e.length>1024?e.substring(0,1024):e,r.title=e.startsWith("data:")?"[ Binary Data ]":e,r}async renderCollectionAsKeyValuePairs(t,e,a){let r=this.createCollectionDetailsElement(t,this.path.join("."),["collection","key-value-pairs"]),i=document.createElement("ul");r.append(i);for(let n=0;n<e.length;n++)this.path.push(e[n].key),await this.renderObjectProperty(e[n].key,e[n].value,i),this.path.pop();a.append(r)}async renderCollectionAsValues(t,e,a){let r=this.createCollectionDetailsElement(t,this.path.join("."),["collection","values"]),i=document.createElement("ul");r.append(i);for(let n=0;n<e.length;n++)this.path.push(e[n]),await this.renderObjectAsValue(e[n],e[n],i),this.path.pop();a.append(r)}async renderObjectAsValue(t,e,a){let r=document.createElement("li");r.classList.add("property"),r.dataset.path=this.path.join(".");let i=document.createElement("span");i.classList.add("value"),i.textContent=e.toString(),i.title="[ Object ]";let n=document.createElement("button");n.innerHTML=m,n.title="Remove",n.classList.add("remove"),r.append(i,n),a.append(r)}renderDataObject(t,e){if(Array.isArray(t))for(let a=0;a<t.length;a++){let r=t[a],i=document.createElement("details"),n=document.createElement("summary"),s=r.name??r.description??r.key;(s==null||s.trim()=="")&&(s=a.toString()),n.classList.add("property"),n.textContent=s.substring(0,Math.min(s.length,20)),i.classList.add("subrecord"),e.appendChild(i),i.appendChild(n),this.renderDataObject(r,i)}else{let a=null;for(let[r,i]of Object.entries(t))if(Array.isArray(i)||Object.prototype.toString.call(i)==="[object Object]"){let n=document.createElement("details"),s=document.createElement("summary");s.classList.add("property"),s.textContent=r,n.classList.add("subrecord"),e.appendChild(n),n.appendChild(s),this.renderDataObject(i,n)}else{a==null&&(a=e.querySelector(":scope > ul"),a==null&&(a=document.createElement("ul"),e.appendChild(a)));let n=document.createElement("li");n.classList.add("property");let s=document.createElement("span");s.classList.add("name"),s.textContent=r;let o=document.createElement("span");o.classList.add("value");let l=i.toString();o.textContent=l.substring(0,Math.min(l.length,20)),n.append(s,o),a.append(n)}}}draftObject(t){return Object.assign({},t,this.extractProperties(t))}extractProperties(t){let e=this.getPropertyNames(t),a={};for(let r=0;r<e.length;r++)a[e[r]]=t[e[r]];return a}getPropertyNames(t){let e=Reflect.getPrototypeOf(t),a=Object.getOwnPropertyDescriptors(e);return Object.entries(a).filter(r=>typeof r[1].get=="function"&&r[0]!=="__proto__").map(r=>r[0])}};customElements.get(y)==null&&customElements.define(y,h);export{h as RecordTreeElement};
